(()=>{function _(d,t,e){let s=d.selectedIndex;e.setValue(m=>{m.push(t.getValue()[s])}),t.setValue(m=>{m.splice(s,1)});let a=Math.min(s,d.options.length-1);d.selectedIndex=a}function L(d,t,e,s){let a=t.selectedIndex,m=d.selectedIndex,h=0,c=e.getValue()[m].name,o=s.getValue()[a].name;c.toLowerCase()>=o.toLowerCase()&&c>o&&(h=1),e.setValue(i=>{i.push(s.getValue()[a]),i.sort((p,l)=>p.name.toLowerCase()<l.name.toLowerCase()?-1:p.name.toLowerCase()>l.name.toLowerCase()?1:0)}),s.setValue(i=>{i.splice(a,1)});let r=m+h;d.selectedIndex=r;let n=Math.min(a,t.options.length-1);t.selectedIndex=n}var S=class{constructor(t){this.value=t,this.subscriptions=[]}getValue(){return this.value}setValue(t){typeof t=="function"?t(this.value):this.value=t;for(let e of this.subscriptions)e(this.value)}addReactor(t,e=!0){this.subscriptions.push(t),e&&t(this.value)}};function k(d){let t=document.createElement("template");return t.innerHTML=d,t.content.childNodes}var F=(d,t,e,s,a)=>{let m=e.length,h=t.length,c=m,o=0,r=0,n=null;for(;o<h||r<c;)if(h===o){let i=c<m?r?s(e[r-1],-0).nextSibling:s(e[c-r],0):a;for(;r<c;)d.insertBefore(s(e[r++],1),i)}else if(c===r)for(;o<h;)(!n||!n.has(t[o]))&&d.removeChild(s(t[o],-1)),o++;else if(t[o]===e[r])o++,r++;else if(t[h-1]===e[c-1])h--,c--;else if(t[o]===e[c-1]&&e[r]===t[h-1]){let i=s(t[--h],-1).nextSibling;d.insertBefore(s(e[r++],1),s(t[o++],-1).nextSibling),d.insertBefore(s(e[--c],1),i),t[h]=e[c]}else{if(!n){n=new Map;let i=r;for(;i<c;)n.set(e[i],i++)}if(n.has(t[o])){let i=n.get(t[o]);if(r<i&&i<c){let p=o,l=1;for(;++p<h&&p<c&&n.get(t[p])===i+l;)l++;if(l>i-r){let D=s(t[o],0);for(;r<i;)d.insertBefore(s(e[r++],1),D)}else d.replaceChild(s(e[r++],1),s(t[o++],-1))}else o++}else d.removeChild(s(t[o++],-1))}return e};var x=class{constructor(t){this.rootNode=document.getElementById(t),this.nodes=[],this.states={}}subscribeTo(t,e){this.states[t]=e,e.addReactor(()=>{this.update()})}batchSubscribe(t){for(let e=0;e<t.length;e++){let s=t[e];this.states[s.refName]=s.state,s.state.addReactor(()=>{this.update()},!1)}this.update()}update(){this.nodes=this.createNodes(),this.render()}createNodes(){return[]}render(){F(this.rootNode,[...this.rootNode.childNodes],[...this.nodes],t=>t)}},f=class extends x{constructor(t){super(t)}setOnClick(t){this.rootNode.addEventListener("click",t)}},v=class extends x{constructor(t){super(t),this.rootNode.addEventListener("change",e=>{e.target.checked?this.states.data.setValue(s=>{s["active-data"]="normalized"}):this.states.data.setValue(s=>{s["active-data"]="raw"})})}},g=class extends x{constructor(t){super(t),this.idToIndexMap=new Map}get value(){return Number(this.rootNode.value)}get selectedIndex(){return this.idToIndexMap.get(this.value)}get options(){return this.rootNode.options}set selectedIndex(t){this.rootNode.selectedIndex=t}update(){let t=this.states.sdks.getValue();for(let e=0;e<t.length;e++)this.idToIndexMap.set(t[e].id,e);super.update()}createNodes(){let t=this.states.sdks.getValue(),e="";for(let s=0;s<t.length;s++){let a=t[s];e+=`<option value="${a.id}">${a.name}</option>`}return k(e)}moveSelectedOptionUp(){let t=this.selectedIndex,e=Math.max(t-1,0);this.states.sdks.setValue(s=>{[s[e],s[t]]=[s[t],s[e]]}),this.selectedIndex=e}moveSelectedOptionDown(){let t=this.selectedIndex,e=Math.min(t+1,this.options.length-1);this.states.sdks.setValue(s=>{[s[e],s[t]]=[s[t],s[e]]}),this.selectedIndex=e}},T=class extends x{constructor(t){super(t),this.cellToSDKIDs={}}update(){super.update();for(let[t,e]of Object.entries(this.cellToSDKIDs))document.getElementById(t).addEventListener("click",()=>{this.states.data.setValue(a=>{a["selected-cell"]["from-sdk"]=e["from-sdk"],a["selected-cell"]["to-sdk"]=e["to-sdk"]})})}createNodes(){let t=this.states.data.getValue(),e=this.states["from-sdks"].getValue(),s=this.states["to-sdks"].getValue(),a=[...e],m=[...s];a.push({id:null,name:"(none)"}),m.push({id:null,name:"(none)"});let h=a.length,c=m.length,o="";o+="<tr>",o+="<th></th>",o+=`<th colspan="${c+1}">To SDK</th>`,o+="</tr>",o+="<tr>",o+=`<th rowspan="${h+2}">From SDK</th>`,o+="</tr>",o+="<tr>",o+="<th></th>";for(let i=0;i<c;i++)o+=`<th>${m[i].name}</th>`;o+="</tr>";let r=t["active-data"],n=t.data[r];for(let i=0;i<n.length;i++){let p=n[i];o+="<tr>",o+=`<th>${a[i].name}</th>`;for(let l=0;l<p.length;l++){let D=p[l];r=="normalized"&&(D=`${(D*100).toFixed(0)}%`);let u=`cmc-${i}${l}`;o+=`<td id=${u}>${D}</td>`,this.cellToSDKIDs[u]={"from-sdk":a[i].id,"to-sdk":m[l].id}}o+="</tr>"}return k(o)}},b=class extends x{constructor(t){super(t)}createNodes(){let t=this.states.appList.getValue(),e="";for(let s=0;s<t.apps.length;s++){let a=t.apps[s];e+="<div>",e+="  <div>",e+=`    <img src=${a.artwork_large_url}/>`,e+="  </div>",e+="  <div>",e+=`    <h1>${a.name}</h1>`,e+="    <p>",e+=`      <a href=${a.company_url}">`,e+=`      ${a.seller_name}`,e+="      </a>",e+="    </p>",e+="    <p>",e+='      <span class="fa-solid fa-star"></span>',e+=`      ${a.rating}`,e+="    </p>",e+="  </div>",e+="</div>"}return k(e)}};var I="/api/v1";document.addEventListener("DOMContentLoaded",N,!1);var B=class{constructor(){this.selectableFromSDKs=new S([]),this.activeFromSDKs=new S([]),this.selectableToSDKs=new S([]),this.activeToSDKs=new S([]),this.compmatrixData=new S({data:{raw:[],normalized:[]},"active-data":"raw","selected-cell":{"from-sdk":null,"to-sdk":null}}),this.appListData=new S({apps:[],"start-cursor":null,"end-cursor":null}),this.matrixTable=new T("compmatrix"),this.matrixTable.batchSubscribe([{refName:"data",state:this.compmatrixData},{refName:"from-sdks",state:this.activeFromSDKs},{refName:"to-sdks",state:this.activeToSDKs}]),this.matrixTableDataToggler=new v("compmatrix-data-toggle"),this.matrixTableDataToggler.subscribeTo("data",this.compmatrixData),this.fromSDKComboBox=new g("from-sdk-selectables"),this.fromSDKComboBox.subscribeTo("sdks",this.selectableFromSDKs),this.activeFromSDKsList=new g("from-sdk-selected"),this.activeFromSDKsList.subscribeTo("sdks",this.activeFromSDKs),this.toSDKComboBox=new g("to-sdk-selectables"),this.toSDKComboBox.subscribeTo("sdks",this.selectableToSDKs),this.activeToSDKsList=new g("to-sdk-selected"),this.activeToSDKsList.subscribeTo("sdks",this.activeToSDKs),this.fromSDKAddBtn=new f("from-sdk-config-list-add-btn"),this.selectedFromSDKRemoveBtn=new f("from-sdk-selected-remove-btn"),this.selectedFromSDKUpBtn=new f("from-sdk-selected-move-up-btn"),this.selectedFromSDKDownBtn=new f("from-sdk-selected-move-down-btn"),this.toSDKAddBtn=new f("to-sdk-config-list-add-btn"),this.selectedToSDKRemoveBtn=new f("to-sdk-selected-remove-btn"),this.selectedToSDKUpBtn=new f("to-sdk-selected-move-up-btn"),this.selectedToSDKDownBtn=new f("to-sdk-selected-move-down-btn"),this.appList=new b("apps-list"),this.appList.subscribeTo("appList",this.appListData),this.fromSDKAddBtn.setOnClick(()=>{_(this.fromSDKComboBox,this.selectableFromSDKs,this.activeFromSDKs)}),this.selectedFromSDKRemoveBtn.setOnClick(()=>{L(this.fromSDKComboBox,this.activeFromSDKsList,this.selectableFromSDKs,this.activeFromSDKs)}),this.selectedFromSDKUpBtn.setOnClick(()=>{this.activeFromSDKsList.moveSelectedOptionUp()}),this.selectedFromSDKDownBtn.setOnClick(()=>{this.activeFromSDKsList.moveSelectedOptionDown()}),this.toSDKAddBtn.setOnClick(()=>{_(this.toSDKComboBox,this.selectableToSDKs,this.activeToSDKs)}),this.selectedToSDKRemoveBtn.setOnClick(()=>{L(this.toSDKComboBox,this.activeToSDKsList,this.selectableToSDKs,this.activeToSDKs)}),this.selectedToSDKUpBtn.setOnClick(()=>{this.activeToSDKsList.moveSelectedOptionUp()}),this.selectedToSDKDownBtn.setOnClick(()=>{this.activeToSDKsList.moveSelectedOptionDown()}),this.compmatrixData.addReactor(()=>{this.#e()}),this.activeFromSDKs.addReactor(()=>{this.#t()}),this.activeToSDKs.addReactor(()=>{this.#t()})}async init(){this.#s(),this.#e()}async#s(){let t=`${I}/sdks`;try{let a=(await(await fetch(t)).json()).data.sdks,m=[];for(let h=0;h<a.length;h++)m.push({id:a[h].id,name:a[h].name});this.selectableFromSDKs.setValue(structuredClone(m)),this.selectableToSDKs.setValue(structuredClone(m))}catch(e){console.error(e.message)}}async#t(){let t=`${I}/sdk-compmatrix/numbers`,e=this.activeFromSDKs.getValue().map(n=>n.id),s=this.activeToSDKs.getValue().map(n=>n.id),a=[];e.length!==0?a.push(...e.map(n=>["from_sdks",n])):a.push(["from_sdks",""]),s.length!==0?a.push(...s.map(n=>["to_sdks",n])):a.push(["to_sdks",""]);let h=new URLSearchParams(a).toString(),c;try{c=await(await fetch(`${t}?${h}`)).json()}catch(n){console.error(n.message)}let o=c.data.numbers,r=[];for(let n=0;n<c.data.numbers.length;n++){let i=c.data.numbers[n],p=i.reduce((D,u)=>D+u,0),l=[];for(let D=0;D<i.length;D++)l.push(i[D]/p);r.push(l)}this.compmatrixData.setValue(n=>{n.data.raw=o,n.data.normalized=r})}async#e(){let t=`${I}/sdk-compmatrix/apps`,e=this.compmatrixData.getValue(),s=e["selected-cell"]["from-sdk"],a=e["selected-cell"]["to-sdk"],m=this.activeFromSDKs.getValue(),h=this.activeToSDKs.getValue(),c=m.filter(l=>s!==null?l.id!=s.id:!0),o=h.filter(l=>a!==null?l.id!=a.id:!0),r=[];s!==null?r.push(["from_sdk",s]):c.length!==0&&r.push(...c.map(l=>["other_from_sdks",l.id])),a!==null?r.push(["to_sdk",a]):o.length!==0&&r.push(...o.map(l=>["other_to_sdks",l.id])),r.push(["count",50]);let i=new URLSearchParams(r).toString(),p;try{p=await(await fetch(`${t}?${i}`)).json()}catch(l){console.error(l.message)}this.appListData.setValue(l=>{l.apps=[];for(let D=0;D<p.data.apps.length;D++){let u=p.data.apps[D],C=null;u.company_url!=""&&(C=u.company_url);let w=u.five_star_ratings;w+=u.four_star_ratings,w+=u.three_star_ratings,w+=u.two_star_ratings,w+=u.one_star_ratings;let K=0;K+=u.five_star_ratings*5,K+=u.four_star_ratings*4,K+=u.three_star_ratings*3,K+=u.two_star_ratings*2,K+=u.one_star_ratings*1,K/=w,l.apps.push({name:u.name,seller_name:u.seller_name,company_url:C,artwork_large_url:u.artwork_large_url,rating:K})}l["start-cursor"]=p.data.start_cursor,l["end-cursor"]=p.data.end_cursor})}};function N(){new B().init()}})();
