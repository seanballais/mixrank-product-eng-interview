(()=>{var P="/api/v1";console.assert(!0);var f=class{static#t=0;static#e=1;static#s=2;static#a=3;static get EMPTY(){return this.#t}static get LOADING(){return this.#e}static get ERRORED(){return this.#s}static get LOADED(){return this.#a}},K=class{static get PREVIOUS(){return"previous"}static get NEXT(){return"next"}};async function W(p,t){let e=`${P}/sdks`;try{let n=(await(await fetch(e)).json()).data.sdks,i=[];for(let l=0;l<n.length;l++)i.push({id:n[l].id,name:n[l].name});p.setValue(structuredClone(i)),t.setValue(structuredClone(i))}catch(s){console.error(s.message)}}async function F(p,t,e){let s=`${P}/sdk-compmatrix/numbers`,o=t.getValue().map(c=>c.id),n=e.getValue().map(c=>c.id),i=[];o.length!==0?i.push(...o.map(c=>["from_sdks",c])):i.push(["from_sdks",""]),n.length!==0?i.push(...n.map(c=>["to_sdks",c])):i.push(["to_sdks",""]);let a=new URLSearchParams(i).toString(),r;try{p.setValue(g=>{g.state=f.LOADING}),r=await(await fetch(`${s}?${a}`)).json()}catch(c){console.error(c.message),p.setValue(g=>{g.state=f.ERRORED})}let d=r.data.numbers,m=[];for(let c=0;c<r.data.numbers.length;c++){let g=r.data.numbers[c],u=g.reduce((b,x)=>b+x,0),I=[];for(let b=0;b<g.length;b++)I.push(g[b]/u);m.push(I)}p.setValue(c=>{c.data.raw=d,c.data.normalized=m,c.state=f.LOADED})}async function B(p,t,e,s,o=null,n=null){let i=`${P}/sdk-compmatrix/apps`,l=t.getValue(),a=l["selected-cell"]["from-sdk"],r=l["selected-cell"]["to-sdk"],d=e.getValue(),m=s.getValue(),c=d.filter(h=>a!==null?h.id!=a.id:!0),g=m.filter(h=>r!==null?h.id!=r.id:!0),u=[];a!==null&&a.id!==null?u.push(["from_sdk",a.id]):c.length!==0&&u.push(...c.map(h=>["other_from_sdks",h.id])),r!==null&&r.id!==null?u.push(["to_sdk",r.id]):g.length!==0&&u.push(...g.map(h=>["other_to_sdks",h.id])),u.push(["count",50]),o!==null&&(u.push(["cursor",o]),u.push(["direction",n]));let b=new URLSearchParams(u).toString(),x;try{p.setValue(T=>{T.state=f.LOADING,o!==null&&(T["is-loading-new-batch"]=!0)}),x=await(await fetch(`${i}?${b}`)).json()}catch(h){console.error(h.message)}p.setValue(h=>{h.state=f.LOADED,h["is-loading-new-batch"]=!1;let T=x.data.apps.length,H=x.data.total_count;h["total-app-count"]=H,o===null&&(h["displayed-apps"]=[]);for(let v=0;v<T;v++){let D=x.data.apps[v],y=null;D.company_url!=""&&(y=D.company_url);let C=D.five_star_ratings;C+=D.four_star_ratings,C+=D.three_star_ratings,C+=D.two_star_ratings,C+=D.one_star_ratings;let _=0;_+=D.five_star_ratings*5,_+=D.four_star_ratings*4,_+=D.three_star_ratings*3,_+=D.two_star_ratings*2,_+=D.one_star_ratings*1,_/=C;let j={name:D.name,seller_name:D.seller_name,company_url:y,artwork_large_url:D.artwork_large_url,rating:_};o!==null&&n===K.PREVIOUS?h["displayed-apps"].splice(v,0,j):h["displayed-apps"].push(j)}o===null?(h["start-cursor"]=x.data.start_cursor,h["end-cursor"]=x.data.end_cursor):n===K.PREVIOUS?h["start-cursor"]=x.data.start_cursor:h["end-cursor"]=x.data.end_cursor;let U=!1,z=!1,G=h["displayed-apps"].length;if(G>150){let v=G-150;if(n===K.PREVIOUS){h["displayed-apps"].splice(-v);let D=h["displayed-apps"].length,y=h["displayed-apps"][D-1];h["end-cursor"]=Z(y),z=!0,h.pruned=!0}else{h["displayed-apps"].splice(0,v);let D=h["displayed-apps"][0];h["start-cursor"]=Z(D),U=!0,h.pruned=!0}}h["recent-batch-size"]=T,T==H?(h["need-prev-batch-trigger"]=!1,h["need-next-batch-trigger"]=!1):T==0?n===K.PREVIOUS?h["need-prev-batch-trigger"]=!1:h["need-next-batch-trigger"]=!1:n===K.PREVIOUS?h["need-prev-batch-trigger"]=!0:h["need-next-batch-trigger"]=!0,U?h["need-prev-batch-trigger"]=!0:z&&(h["need-next-batch-trigger"]=!0)})}function N(p,t,e,s){let n=t.getValue()["selected-cell"];if(n){let i=n["from-sdk"],l=n["to-sdk"];(i.id===null||l.id===null)&&B(p,t,e,s)}}function Z(p){return`${p.name};${p.seller_name}`}function R(p,t,e,s){let o=t.getValue(),n=s.getValue();if(o.length>0){let i=p.selectedIndex,l=e.selectedIndex;s.setValue(r=>{r.push(t.getValue()[i])}),t.setValue(r=>{r.splice(i,1)});let a=Math.min(i,p.options.length-1);p.selectedIndex=a,n.length>0&&l!==null&&(e.selectedIndex=l)}}function $(p,t,e,s){let o=t.getValue(),n=s.getValue(),i=p.selectedIndex,l=e.selectedIndex;if(n.length>0&&l!==null){let a=0;if(o.length>0){let d=t.getValue()[i].name,m=s.getValue()[l].name;d.toLowerCase()>=m.toLowerCase()&&d>m&&(a=1)}t.setValue(d=>{d.push(s.getValue()[l]),d.sort((m,c)=>m.name.toLowerCase()<c.name.toLowerCase()?-1:m.name.toLowerCase()>c.name.toLowerCase()?1:0)}),s.setValue(d=>{d.splice(l,1)}),o.length>0?p.selectedIndex=i+a:p.selectedIndex=0;let r=Math.min(l,e.options.length-1);e.selectedIndex=r}}var w=class{constructor(t){this.value=structuredClone(t),this.initialValue=structuredClone(t),this.subscriptions=[],this.isPropagationLocked=!1}getValue(){return this.value}setValue(t){typeof t=="function"?t(this.value):this.value=t,this.isPropagationLocked||this.#t()}resetToInitialState(){this.setValue(structuredClone(this.initialValue))}addReactor(t,e=!0,s=!1){s?this.subscriptions.unshift(t):this.subscriptions.push(t),e&&t(this.value)}lockPropagation(){this.isPropagationLocked=!0}unlockPropagation(t=!0){this.isPropagationLocked=!1,t&&this.#t()}#t(){for(let t of this.subscriptions)t()}};var Y=(p,t,e,s,o)=>{let n=e.length,i=t.length,l=n,a=0,r=0,d=null;for(;a<i||r<l;)if(i===a){let m=l<n?r?s(e[r-1],-0).nextSibling:s(e[l-r],0):o;for(;r<l;)p.insertBefore(s(e[r++],1),m)}else if(l===r)for(;a<i;)(!d||!d.has(t[a]))&&p.removeChild(s(t[a],-1)),a++;else if(t[a]===e[r])a++,r++;else if(t[i-1]===e[l-1])i--,l--;else if(t[a]===e[l-1]&&e[r]===t[i-1]){let m=s(t[--i],-1).nextSibling;p.insertBefore(s(e[r++],1),s(t[a++],-1).nextSibling),p.insertBefore(s(e[--l],1),m),t[i]=e[l]}else{if(!d){d=new Map;let m=r;for(;m<l;)d.set(e[m],m++)}if(d.has(t[a])){let m=d.get(t[a]);if(r<m&&m<l){let c=a,g=1;for(;++c<i&&c<l&&d.get(t[c])===m+g;)g++;if(g>m-r){let u=s(t[a],0);for(;r<m;)p.insertBefore(s(e[r++],1),u)}else p.replaceChild(s(e[r++],1),s(t[a++],-1))}else a++}else p.removeChild(s(t[a++],-1))}return e};var S=class{constructor(t){this.rootNode=document.getElementById(t),this.nodes=[],this.states={}}subscribeTo(t,e){this.states[t]=e,e.addReactor(()=>{this.update()})}batchSubscribe(t){for(let e=0;e<t.length;e++){let s=t[e];this.states[s.refName]=s.state,s.state.addReactor(()=>{this.update()},!1,!1)}this.update()}update(){this.nodes=this.#t(this.createHTML()),this.render()}createHTML(){return""}render(){Y(this.rootNode,[...this.rootNode.childNodes],[...this.nodes],t=>t)}#t(t){let e=document.createElement("template");return e.innerHTML=t,e.content.childNodes}};var V=class extends S{constructor(t){super(t)}createHTML(){let t=this.states["compmatrix-data"].getValue(),e="<p>";if(t["selected-cell"]===null)e+="Select a cell in the competitive matrix to get started.";else{let s=t["selected-cell"]["from-sdk"],o=t["selected-cell"]["to-sdk"],n="";s===null?n="(none)":n=s.name;let i="";o===null?i="(none)":i=o.name,e+=`Migrated from ${n} to ${i}.`}return e+="</p>",e}};var O=class extends S{constructor(t){super(t),this.prevBatchTriggerObserver=null,this.nextBatchTriggerObserver=null,this.isBatchLoading=!1}update(){let t=this.states["compmatrix-data"].getValue(),e=this.states["app-list"],s=e.getValue();if(e.lockPropagation(),t["selected-cell"]===null&&s["displayed-apps"].length>0&&e.resetToInitialState(),s.state===f.LOADING&&!s["is-loading-new-batch"]&&this.rootNode.scrollTo({top:0,left:0,behavior:"instant"}),super.update(),s=e.getValue(),s.state===f.LOADED){let o={root:this.rootNode};if(s["need-prev-batch-trigger"]){let n=(a,r)=>{for(let d=0;d<a.length;d++){let m=a[d];m&&m.isIntersecting&&!this.isBatchLoading&&this.#t(s["start-cursor"],K.PREVIOUS)}};this.prevBatchTriggerObserver=new IntersectionObserver(n,o);let l=document.getElementById("app-prev-batch-trigger");this.prevBatchTriggerObserver.observe(l)}if(s["need-next-batch-trigger"]){let n=(a,r)=>{for(let d=0;d<a.length;d++){let m=a[d];m&&m.isIntersecting&&!this.isBatchLoading&&this.#t(s["end-cursor"],K.NEXT)}};this.nextBatchTriggerObserver=new IntersectionObserver(n,o);let l=document.getElementById("app-next-batch-trigger");this.nextBatchTriggerObserver.observe(l)}}e.unlockPropagation(!1)}createHTML(){let t=this.states["app-list"].getValue(),e="";if(t.state===f.LOADED||t.state===f.LOADING&&t["is-loading-new-batch"]){e+='<ol id="apps-list-items">',t["need-prev-batch-trigger"]&&(e+=`
                    <li id="app-prev-batch-trigger" class="batch-trigger">
                        <span class="fas fa-circle-notch fa-spin"></span>
                    </li>
                `);for(let s=0;s<t["displayed-apps"].length;s++){let o=t["displayed-apps"][s];e+=`
                    <li class="app-card">
                        <div class="app-card-icon">
                            <img src=${o.artwork_large_url}/>
                        </div>
                        <div class="app-card-info">
                            <h1>${o.name}</h1>
                            <p class="app-card-info-company">
                                <a href=${o.company_url}">
                                ${o.seller_name}
                                </a>
                            </p>
                            <p>
                                <span class="fa-solid fa-star app-rating-icon">
                                </span>
                                ${o.rating.toFixed(2)}
                            </p>
                        </div>
                    </li>
                `}t["need-next-batch-trigger"]&&(e+=`
                    <li id="app-next-batch-trigger" class="batch-trigger">
                        <span class="fas fa-circle-notch fa-spin"></span>
                    </li>
                `),e+="</ol>"}else t.state===f.LOADING&&(e+=`
                <div id="app-list-loader-icon">
                    <span class="fas fa-circle-notch fa-spin"></span>
                </div>
            `);return e}async#t(t,e){this.isBatchLoading=!0;let s=this.states["app-list"].getValue();await B(this.states["app-list"],this.states["compmatrix-data"],this.states["from-sdks"],this.states["to-sdks"],t,e);let o=s["recent-batch-size"];if(s.pruned&&o!==0){let n=document.getElementById("apps-list-items"),i=[...n.children],l=e==K.PREVIOUS?i.slice(0,o+1):i.slice(-o-1),a=window.getComputedStyle(n),r=0;if(l.length>0){let m=n.getBoundingClientRect().x,c=0;for(let I=0;I<l.length;I++){let b=l[I].getBoundingClientRect();b.x==m&&(r+=b.height,c++)}let g=a.getPropertyValue("row-gap"),u=parseInt(g);r+=u*(c-1),r-=u*3.5}e===K.NEXT&&(r=-r),this.rootNode.scrollBy(0,r)}this.isBatchLoading=!1}};var k=class extends S{constructor(t){super(t)}setOnClick(t){this.rootNode.addEventListener("click",t)}};var E=class extends S{constructor(t){super(t),this.rootNode.addEventListener("change",e=>{e.target.checked?this.states.data.setValue(s=>{s["active-data"]="normalized"}):this.states.data.setValue(s=>{s["active-data"]="raw"})})}};var A=class extends S{constructor(t){super(t),this.cellToSDKs={},this.selectedCellID=null}clearSelectedCell(){this.selectedCellID=null,this.states.data.setValue(t=>{t["selected-cell"]=null})}update(){if(this.cellToSDKs={},super.update(),this.states.data.getValue().state==f.LOADED){for(let[s,o]of Object.entries(this.cellToSDKs))document.getElementById(s).addEventListener("click",()=>{s==this.selectedCellID?(this.states.data.setValue(i=>{i["selected-cell"]=null}),this.selectedCellID=null):(this.states.data.setValue(i=>{i["selected-cell"]={"from-sdk":o["from-sdk"],"to-sdk":o["to-sdk"]}}),this.selectedCellID=this.#e(),B(this.states["app-list"],this.states.data,this.states["from-sdks"],this.states["to-sdks"]))});if(this.#t(),!this.selectedCellID){let s=this.states.data;s.lockPropagation(),this.states.data.setValue(o=>{o["selected-cell"]=null}),s.unlockPropagation(!1)}}}createHTML(){let t=this.states.data.getValue(),e=t.state,s=this.#s(),o=s["from-sdks"],n=s["to-sdks"],i=o.length,l=n.length,a="";if(a+="<tr>",a+="<th></th>",a+=`<th colspan="${l+1}">To SDK</th>`,a+="</tr>",a+="<tr>",a+=`<th rowspan="${i+2}">`,a+="<span>From SDK</span>",a+="</th>",a+="</tr>",e==f.LOADED){a+="<tr>",a+="<th></th>";for(let c=0;c<l;c++)a+=`<th>${n[c].name}</th>`;a+="</tr>";let r=t["active-data"],d=t.data[r],m=t.data.normalized;for(let c=0;c<d.length;c++){let g=d[c];a+="<tr>",a+=`<th>${o[c].name}</th>`;for(let u=0;u<g.length;u++){let I=g[u];r=="normalized"&&(I=`${(I*100).toFixed(0)}%`);let b=m[c][u],x=this.#a(c,u),T=`background-color: ${`hsla(0, 80%, 55%, ${b*100}%)`}`;a+=`
                        <td id="${x}" style="${T}">${I}</td>
                    `,this.cellToSDKs[x]={"from-sdk":o[c],"to-sdk":n[u]}}a+="</tr>"}}else e==f.LOADING&&(a+="<tr>",a+="<td>",a+='<span class="fas fa-circle-notch fa-spin"></span>',a+="</td>",a+="</tr>");return a}#t(){let t=this.#e();if(t){let e=document.getElementById(t);e&&e.classList.add("selected-cell"),this.selectedCellID=t}else this.selectedCellID=null}#e(){let t=this.states.data.getValue(),e=this.#s(),s=t["selected-cell"];if(s){let o=s["from-sdk"],n=s["to-sdk"],i=null,l=e["from-sdks"];for(let d=0;d<l.length;d++)l[d].id==o.id&&(i=d);let a=null,r=e["to-sdks"];for(let d=0;d<r.length;d++)r[d].id==n.id&&(a=d);if(i!==null&&a!==null)return this.#a(i,a)}return null}#s(){let t=this.states["from-sdks"].getValue(),e=this.states["to-sdks"].getValue(),s=[...t],o=[...e];return s.push({id:null,name:"(none)"}),o.push({id:null,name:"(none)"}),{"from-sdks":s,"to-sdks":o}}#a(t,e){return`cmc-${t}${e}`}};var L=class extends S{constructor(t){super(t),this.idToIndexMap=new Map}get value(){return Number(this.rootNode.value)}get selectedIndex(){let t=this.idToIndexMap.get(this.value);return t===void 0?null:t}get options(){return this.rootNode.options}set selectedIndex(t){this.rootNode.selectedIndex=t}update(){let t=this.states.sdks.getValue();for(let e=0;e<t.length;e++)this.idToIndexMap.set(t[e].id,e);super.update()}createHTML(){let t=this.states.sdks.getValue(),e="";for(let s=0;s<t.length;s++){let o=t[s];e+=`<option value="${o.id}">${o.name}</option>`}return e}moveSelectedOptionUp(){let t=this.selectedIndex,e=Math.max(t-1,0);this.states.sdks.setValue(s=>{[s[e],s[t]]=[s[t],s[e]]}),this.selectedIndex=e}moveSelectedOptionDown(){let t=this.selectedIndex,e=Math.min(t+1,this.options.length-1);this.states.sdks.setValue(s=>{[s[e],s[t]]=[s[t],s[e]]}),this.selectedIndex=e}};document.addEventListener("DOMContentLoaded",Q,!1);var M=class{constructor(){this.selectableFromSDKs=new w([]),this.activeFromSDKs=new w([]),this.selectableToSDKs=new w([]),this.activeToSDKs=new w([]),this.compmatrixData=new w({data:{raw:[],normalized:[]},state:f.EMPTY,"active-data":"raw","selected-cell":null}),this.appListData=new w({"displayed-apps":[],"total-app-count":0,"recent-batch-size":0,state:f.EMPTY,pruned:!1,"is-loading-new-batch":!1,"start-cursor":null,"end-cursor":null,"need-prev-batch-trigger":!1,"need-next-batch-trigger":!1}),this.matrixTable=new A("compmatrix"),this.matrixTable.batchSubscribe([{refName:"data",state:this.compmatrixData},{refName:"from-sdks",state:this.activeFromSDKs},{refName:"to-sdks",state:this.activeToSDKs},{refName:"app-list",state:this.appListData}]),this.matrixTableDataToggler=new E("compmatrix-data-toggle"),this.matrixTableDataToggler.subscribeTo("data",this.compmatrixData),this.fromSDKComboBox=new L("from-sdk-selectables"),this.fromSDKComboBox.subscribeTo("sdks",this.selectableFromSDKs),this.activeFromSDKsList=new L("from-sdk-selected"),this.activeFromSDKsList.subscribeTo("sdks",this.activeFromSDKs),this.toSDKComboBox=new L("to-sdk-selectables"),this.toSDKComboBox.subscribeTo("sdks",this.selectableToSDKs),this.activeToSDKsList=new L("to-sdk-selected"),this.activeToSDKsList.subscribeTo("sdks",this.activeToSDKs),this.fromSDKAddBtn=new k("from-sdk-config-list-add-btn"),this.selectedFromSDKRemoveBtn=new k("from-sdk-selected-remove-btn"),this.selectedFromSDKUpBtn=new k("from-sdk-selected-move-up-btn"),this.selectedFromSDKDownBtn=new k("from-sdk-selected-move-down-btn"),this.toSDKAddBtn=new k("to-sdk-config-list-add-btn"),this.selectedToSDKRemoveBtn=new k("to-sdk-selected-remove-btn"),this.selectedToSDKUpBtn=new k("to-sdk-selected-move-up-btn"),this.selectedToSDKDownBtn=new k("to-sdk-selected-move-down-btn"),this.appList=new O("apps-list"),this.appList.batchSubscribe([{refName:"app-list",state:this.appListData},{refName:"compmatrix-data",state:this.compmatrixData},{refName:"from-sdks",state:this.activeFromSDKs},{refName:"to-sdks",state:this.activeToSDKs}]),this.appListDesc=new V("app-list-desc"),this.appListDesc.batchSubscribe([{refName:"app-list",state:this.appListData},{refName:"compmatrix-data",state:this.compmatrixData}]),this.fromSDKAddBtn.setOnClick(()=>{this.selectableFromSDKs.getValue().length>0&&(R(this.fromSDKComboBox,this.selectableFromSDKs,this.activeFromSDKsList,this.activeFromSDKs),N(this.appListData,this.compmatrixData,this.activeFromSDKs,this.activeToSDKs))}),this.selectedFromSDKRemoveBtn.setOnClick(()=>{$(this.fromSDKComboBox,this.selectableFromSDKs,this.activeFromSDKsList,this.activeFromSDKs)}),this.selectedFromSDKUpBtn.setOnClick(()=>{this.activeFromSDKsList.moveSelectedOptionUp()}),this.selectedFromSDKDownBtn.setOnClick(()=>{this.activeFromSDKsList.moveSelectedOptionDown()}),this.toSDKAddBtn.setOnClick(()=>{this.selectableToSDKs.getValue().length>0&&(R(this.toSDKComboBox,this.selectableToSDKs,this.activeToSDKsList,this.activeToSDKs),N(this.appListData,this.compmatrixData,this.activeFromSDKs,this.activeToSDKs))}),this.selectedToSDKRemoveBtn.setOnClick(()=>{$(this.toSDKComboBox,this.selectableToSDKs,this.activeToSDKsList,this.activeToSDKs)}),this.selectedToSDKUpBtn.setOnClick(()=>{this.activeToSDKsList.moveSelectedOptionUp()}),this.selectedToSDKDownBtn.setOnClick(()=>{this.activeToSDKsList.moveSelectedOptionDown()}),this.activeFromSDKs.addReactor(()=>{F(this.compmatrixData,this.activeFromSDKs,this.activeToSDKs)},!0,!0),this.activeToSDKs.addReactor(()=>{F(this.compmatrixData,this.activeFromSDKs,this.activeToSDKs)},!0,!0)}async init(){W(this.selectableFromSDKs,this.selectableToSDKs)}};function Q(){new M().init()}})();
